<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystic Tarot v3.2: Enhanced Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400&display=swap');

        :root {
            --bg-color: #0f0f13;
            --accent: #d4af37; /* Gold */
            --accent-dim: #8a7020;
            --text-main: #e0e0e0;
            --card-width: 130px; 
            --card-height: 220px;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Lato', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }

        h1 {
            font-family: 'Cinzel', serif;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
            margin-bottom: 10px;
        }

        /* Controls Area */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
            z-index: 10;
            align-items: center;
            background: rgba(20, 20, 25, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #333;
        }

        input[type="text"], input[type="number"], select {
            width: 90%;
            padding: 12px;
            background: #1a1a1a;
            border: 1px solid #444;
            color: white;
            border-radius: 4px;
            font-family: 'Lato', sans-serif;
            outline: none;
            text-align: center;
            transition: 0.3s;
        }
        
        input[type="text"]:focus, input[type="number"]:focus, select:focus { border-color: var(--accent); }

        .btn-group {
            display: flex;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }

        button {
            padding: 12px 20px;
            font-family: 'Cinzel', serif;
            cursor: pointer;
            text-transform: uppercase;
            font-weight: bold;
            transition: 0.3s;
            border-radius: 4px;
            border: 1px solid var(--accent);
        }

        button.shuffle-btn {
            background: transparent;
            color: var(--accent);
        }

        button.shuffle-btn:hover {
            background: rgba(212, 175, 55, 0.1);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
        }

        button.reset-btn {
            background: #333;
            color: #888;
            border-color: #555;
            font-size: 0.8em;
        }
        button.reset-btn:hover { background: #444; color: white; }

        button.finish-btn {
            background: #444;
            color: var(--accent);
            border-color: var(--accent-dim);
        }
        button.finish-btn:hover { background: #555; }

        /* Deck Area */
        .deck-zone {
            height: 260px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .deck-container {
            position: relative;
            width: var(--card-width);
            height: var(--card-height);
            cursor: pointer;
            transition: 0.3s;
        }
        
        .deck-container.locked {
            opacity: 0.5;
            pointer-events: none;
            filter: grayscale(100%);
        }

        .deck-card {
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(45deg, #181825, #181825 10px, #252538 10px, #252538 20px);
            border: 2px solid var(--accent);
            border-radius: 10px;
            position: absolute;
            top: 0; left: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }
        
        .deck-card::after { content: '‚ú¶'; font-size: 40px; color: var(--accent); opacity: 0.4; }

        /* Shuffle Animation */
        @keyframes shuffleLeft {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(-60px, -10px) rotate(-5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        @keyframes shuffleRight {
            0% { transform: translate(0, 0) rotate(0deg); }
            50% { transform: translate(60px, 10px) rotate(5deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        .shuffling .c1 { animation: shuffleLeft 0.5s ease-in-out; animation-iteration-count: 3; }
        .shuffling .c2 { animation: shuffleRight 0.5s ease-in-out; animation-iteration-count: 3; }
        .shuffling .c3 { animation: shuffleLeft 0.5s ease-in-out reverse; animation-iteration-count: 3; }

        .deck-instruction {
            margin-top: 15px;
            font-size: 0.9em;
            color: var(--accent);
            font-style: italic;
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* Spread Area */
        .spread-area {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            max-width: 1200px;
            min-height: 200px;
            padding-bottom: 50px;
        }

        .card-slot {
            width: var(--card-width);
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            animation: fadeIn 0.8s forwards;
            margin-bottom: 20px;
        }
        @keyframes fadeIn { to { opacity: 1; } }

        .card-inner {
            width: var(--card-width);
            height: var(--card-height);
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s;
            cursor: pointer;
        }
        .card-inner.flipped { transform: rotateY(180deg); }
        
        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 10px; border: 2px solid var(--accent);
        }
        .card-front { background: repeating-linear-gradient(45deg, #181825, #181825 10px, #252538 10px, #252538 20px); display: flex; align-items: center; justify-content: center; }
        .card-front::after { content: '‚ú¶'; font-size: 40px; color: var(--accent); }
        .card-back { background: #000; transform: rotateY(180deg); background-size: cover; background-position: center; }
        .card-back.inverted { transform: rotateY(180deg) rotate(180deg); }

        .card-meaning {
            margin-top: 10px;
            font-size: 0.8em;
            text-align: center;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 5px;
            border-top: 1px solid var(--accent);
            display: none;
            width: 100%;
            box-sizing: border-box;
            color: #ccc;
        }
        .card-meaning strong { color: var(--accent); display: block; margin-bottom: 5px; font-family: 'Cinzel';}

        .position-label {
            font-family: 'Cinzel', serif;
            font-size: 0.7em;
            color: #888;
            margin-bottom: 5px;
            text-transform: uppercase;
            text-align: center;
            height: 30px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        /* Result Box - FIXED */
        .output-zone {
            width: 90%;
            max-width: 800px;
            background: #151515;
            padding: 20px;
            border: 1px solid #333;
            border-radius: 8px;
            display: none;
            margin-bottom: 50px;
        }
        textarea { 
            width: 100%; 
            height: auto; 
            min-height: 200px; /* –ë–∞–∑–æ–≤–∞ –≤–∏—Å–æ—Ç–∞ */
            background: #0a0a0a; 
            color: #aaa; 
            border: 1px solid #333; 
            resize: vertical; 
            box-sizing: border-box; 
            padding: 15px; 
            font-family: monospace; 
            white-space: pre-wrap; /* –©–æ–± –ø–µ—Ä–µ–Ω–æ—Å–∏ —Ä—è–¥–∫—ñ–≤ –∑–±–µ—Ä—ñ–≥–∞–ª–∏—Å—å */
        }
        .copy-btn { margin-top: 10px; padding: 12px 30px; background: var(--accent); color: #000; border: none; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; font-weight: bold; width: 100%; }
        .copy-btn:hover { background: white; }

    </style>
</head>
<body>

    <h1>Oracle ‚ú¶ Gemini</h1>
    
    <div class="controls">
        <input type="text" id="userQuestion" placeholder="–¢–≤–æ—î –ø–∏—Ç–∞–Ω–Ω—è –¥–æ –í—Å–µ—Å–≤—ñ—Ç—É...">
        
        <select id="spreadSelector">
            <option value="1">‚ú¶ –ë–ª—ñ—Ü (1 –∫–∞—Ä—Ç–∞)</option>
            <option value="3" selected>‚ú¶ –¢—Ä–∏ –∫–∞—Ä—Ç–∏ (–ú–∏–Ω—É–ª–µ/–¢–µ–ø–µ—Ä./–ú–∞–π–±.)</option>
            <option value="3_alt">‚ú¶ –†–æ–∑—É–º / –°–µ—Ä—Ü–µ / –î—ñ—ó (3 –∫–∞—Ä—Ç–∏)</option>
            <option value="5">‚ú¶ –®–ª—è—Ö (5 –∫–∞—Ä—Ç)</option>
            <option value="10">‚ú¶ –ö–ï–õ–¨–¢–°–¨–ö–ò–ô –•–†–ï–°–¢ (10 –∫–∞—Ä—Ç)</option>
            <option value="free">‚ú¶ –í—ñ–ª—å–Ω–∏–π –†–æ–∑–∫–ª–∞–¥ (–æ–±–∏—Ä–∞–π —Å–∫—ñ–ª—å–∫–∏ —Ö–æ—á–µ—à, –ø–æ —á–µ—Ä–∑—ñ)</option>
        </select>

        <input type="number" id="shuffleCycles" min="1" max="20" value="3" placeholder="–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ü–∏–∫–ª—ñ–≤ —Ç–∞—Å—É–≤–∞–Ω–Ω—è (1-20)">

        <div class="btn-group">
            <button class="shuffle-btn" onclick="startShuffle()">üñê –ü–µ—Ä–µ—Ç–∞—Å—É–≤–∞—Ç–∏ –∫–æ–ª–æ–¥—É</button>
            <button class="reset-btn" onclick="resetAll()">–°–∫–∏–Ω—É—Ç–∏</button>
            <button class="finish-btn" onclick="finishSpread()" style="display: none;">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥</button>
        </div>
    </div>

    <div class="deck-zone">
        <div class="deck-container locked" id="deckContainer" onclick="drawCard()">
            <div class="deck-card c1"></div>
            <div class="deck-card c2" style="transform: translate(2px, 2px);"></div>
            <div class="deck-card c3" style="transform: translate(4px, 4px);"></div>
            <div class="deck-card" style="transform: translate(6px, 6px);"></div>
        </div>
        <div class="deck-instruction" id="deckInst">–ö–æ–ª–æ–¥–∞ –≥–æ—Ç–æ–≤–∞. –¢—è–≥–Ω–∏ –∫–∞—Ä—Ç–∏! (<span id="countDisplay">0</span>/<span id="totalDisplay">0</span>)</div>
    </div>

    <div class="spread-area" id="spreadArea"></div>

    <div class="output-zone" id="outputZone">
        <h3 style="margin-top:0; color:var(--accent); font-family:'Cinzel'">‚ú¶ –¢–≤—ñ–π –†–æ–∑–∫–ª–∞–¥ ‚ú¶</h3>
        <textarea id="resultText" readonly></textarea>
        <button class="copy-btn" onclick="copyResult()">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –≤—Å–µ</button>
    </div>

<script>
    const tarotDeck = [
        { name: "The Fool (–ë–ª–∞–∑–µ–Ω—å)", img: "https://upload.wikimedia.org/wikipedia/commons/9/90/RWS_Tarot_00_Fool.jpg", meaning: "–ù–æ–≤–∏–π —Å—Ç–∞—Ä—Ç, –Ω–∞—ó–≤–Ω—ñ—Å—Ç—å, —Ä–∏–∑–∏–∫." },
        { name: "The Magician (–ú–∞–≥)", img: "https://upload.wikimedia.org/wikipedia/commons/d/de/RWS_Tarot_01_Magician.jpg", meaning: "–î—ñ—è, –º–∞–Ω—ñ—Ñ–µ—Å—Ç–∞—Ü—ñ—è, —Å–∏–ª–∞ –≤–æ–ª—ñ." },
        { name: "The High Priestess (–ñ—Ä–∏—Ü—è)", img: "https://upload.wikimedia.org/wikipedia/commons/8/88/RWS_Tarot_02_High_Priestess.jpg", meaning: "–Ü–Ω—Ç—É—ó—Ü—ñ—è, —Ç–∞—î–º–Ω–∏—Ü—è, –ø—ñ–¥—Å–≤—ñ–¥–æ–º—ñ—Å—Ç—å." },
        { name: "The Empress (–Ü–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü—è)", img: "https://upload.wikimedia.org/wikipedia/commons/d/d2/RWS_Tarot_03_Empress.jpg", meaning: "–†–æ–¥—é—á—ñ—Å—Ç—å, –ø—Ä–∏—Ä–æ–¥–∞, –∫–æ–º—Ñ–æ—Ä—Ç." },
        { name: "The Emperor (–Ü–º–ø–µ—Ä–∞—Ç–æ—Ä)", img: "https://upload.wikimedia.org/wikipedia/commons/c/c3/RWS_Tarot_04_Emperor.jpg", meaning: "–í–ª–∞–¥–∞, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å." },
        { name: "The Hierophant (–Ü—î—Ä–æ—Ñ–∞–Ω—Ç)", img: "https://upload.wikimedia.org/wikipedia/commons/8/8d/RWS_Tarot_05_Hierophant.jpg", meaning: "–¢—Ä–∞–¥–∏—Ü—ñ—è, –º–æ—Ä–∞–ª—å, –Ω–∞–≤—á–∞–Ω–Ω—è." },
        { name: "The Lovers (–ó–∞–∫–æ—Ö–∞–Ω—ñ)", img: "https://upload.wikimedia.org/wikipedia/commons/3/3a/RWS_Tarot_06_Lovers.jpg", meaning: "–õ—é–±–æ–≤, –≤–∏–±—ñ—Ä, –≥–∞—Ä–º–æ–Ω—ñ—è." },
        { name: "The Chariot (–ö–æ–ª—ñ—Å–Ω–∏—Ü—è)", img: "https://upload.wikimedia.org/wikipedia/commons/9/9b/RWS_Tarot_07_Chariot.jpg", meaning: "–í–æ–ª—è, –ø–µ—Ä–µ–º–æ–≥–∞, —Ä—É—Ö." },
        { name: "Strength (–°–∏–ª–∞)", img: "https://upload.wikimedia.org/wikipedia/commons/f/f5/RWS_Tarot_08_Strength.jpg", meaning: "–¢–µ—Ä–ø—ñ–Ω–Ω—è, –º'—è–∫–∞ —Å–∏–ª–∞, –∫–æ–Ω—Ç—Ä–æ–ª—å." },
        { name: "The Hermit (–í—ñ–¥–ª—é–¥–Ω–∏–∫)", img: "https://upload.wikimedia.org/wikipedia/commons/4/4d/RWS_Tarot_09_Hermit.jpg", meaning: "–°–∞–º–æ—Ç–Ω—ñ—Å—Ç—å, –º—É–¥—Ä—ñ—Å—Ç—å, –ø–æ—à—É–∫." },
        { name: "Wheel of Fortune (–ö–æ–ª–µ—Å–æ)", img: "https://upload.wikimedia.org/wikipedia/commons/3/3c/RWS_Tarot_10_Wheel_of_Fortune.jpg", meaning: "–î–æ–ª—è, –∑–º—ñ–Ω–∏, —É–¥–∞—á–∞." },
        { name: "Justice (–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ñ—Å—Ç—å)", img: "https://upload.wikimedia.org/wikipedia/commons/e/e0/RWS_Tarot_11_Justice.jpg", meaning: "–ü—Ä–∞–≤–¥–∞, –∑–∞–∫–æ–Ω, –∫–∞—Ä–º–∞." },
        { name: "The Hanged Man (–ü–æ–≤—ñ—à–µ–Ω–∏–π)", img: "https://upload.wikimedia.org/wikipedia/commons/2/2b/RWS_Tarot_12_Hanged_Man.jpg", meaning: "–ñ–µ—Ä—Ç–≤–∞, –ø–∞—É–∑–∞, —ñ–Ω—à–∏–π –∫—É—Ç –∑–æ—Ä—É." },
        { name: "Death (–°–º–µ—Ä—Ç—å)", img: "https://upload.wikimedia.org/wikipedia/commons/d/d7/RWS_Tarot_13_Death.jpg", meaning: "–ö—ñ–Ω–µ—Ü—å, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü—ñ—è, –ø–µ—Ä–µ—Ö—ñ–¥." },
        { name: "Temperance (–ü–æ–º—ñ—Ä–Ω—ñ—Å—Ç—å)", img: "https://upload.wikimedia.org/wikipedia/commons/f/f8/RWS_Tarot_14_Temperance.jpg", meaning: "–ë–∞–ª–∞–Ω—Å, –∑—Ü—ñ–ª–µ–Ω–Ω—è, –∫–æ–º–ø—Ä–æ–º—ñ—Å." },
        { name: "The Devil (–î–∏—è–≤–æ–ª)", img: "https://upload.wikimedia.org/wikipedia/commons/5/55/RWS_Tarot_15_Devil.jpg", meaning: "–ó–∞–ª–µ–∂–Ω—ñ—Å—Ç—å, –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–∑–º, —Ç—ñ–Ω—å." },
        { name: "The Tower (–í–µ–∂–∞)", img: "https://upload.wikimedia.org/wikipedia/commons/5/53/RWS_Tarot_16_Tower.jpg", meaning: "–ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞, —Ä—É–π–Ω—É–≤–∞–Ω–Ω—è, —ñ–Ω—Å–∞–π—Ç." },
        { name: "The Star (–ó—ñ—Ä–∫–∞)", img: "https://upload.wikimedia.org/wikipedia/commons/d/db/RWS_Tarot_17_Star.jpg", meaning: "–ù–∞–¥—ñ—è, –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è, –≤—ñ—Ä–∞." },
        { name: "The Moon (–ú—ñ—Å—è—Ü—å)", img: "https://upload.wikimedia.org/wikipedia/commons/7/7f/RWS_Tarot_18_Moon.jpg", meaning: "–Ü–ª—é–∑—ñ—è, —Å—Ç—Ä–∞—Ö, –Ω–µ–≤—ñ–¥–æ–º–µ." },
        { name: "The Sun (–°–æ–Ω—Ü–µ)", img: "https://upload.wikimedia.org/wikipedia/commons/1/17/RWS_Tarot_19_Sun.jpg", meaning: "–†–∞–¥—ñ—Å—Ç—å, —É—Å–ø—ñ—Ö, —è—Å–Ω—ñ—Å—Ç—å." },
        { name: "Judgement (–°—É–¥)", img: "https://upload.wikimedia.org/wikipedia/commons/d/dd/RWS_Tarot_20_Judgement.jpg", meaning: "–í—ñ–¥—Ä–æ–¥–∂–µ–Ω–Ω—è, –ø—Ä–æ—â–µ–Ω–Ω—è, –ø–æ–∫–ª–∏–∫." },
        { name: "The World (–°–≤—ñ—Ç)", img: "https://upload.wikimedia.org/wikipedia/commons/f/ff/RWS_Tarot_21_World.jpg", meaning: "–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è, —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å, –ø–æ–¥–æ—Ä–æ–∂." },
        { name: "Ace of Swords (–¢—É–∑ –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/1/1a/Swords01.jpg", meaning: "–Ø—Å–Ω—ñ—Å—Ç—å, –Ω–æ–≤–∞ —ñ–¥–µ—è, –ø—Ä–∞–≤–¥–∞." },
        { name: "2 of Swords (2 –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/9/9f/Swords02.jpg", meaning: "" },
        { name: "3 of Swords (3 –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/0/0e/Swords03.jpg", meaning: "–ë—ñ–ª—å, —Ä–æ–∑–±–∏—Ç–µ —Å–µ—Ä—Ü–µ, —Å–º—É—Ç–æ–∫." },
        { name: "4 of Swords (4 –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/a/a6/Swords04.jpg", meaning: "" },
        { name: "5 of Swords (5 –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/2/23/Swords05.jpg", meaning: "" },
        { name: "6 of Swords (6 –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/2/23/Swords06.jpg", meaning: "" },
        { name: "7 of Swords (7 –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/3/34/Swords07.jpg", meaning: "" },
        { name: "8 of Swords (8 –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/a/a4/Swords08.jpg", meaning: "" },
        { name: "9 of Swords (9 –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/2/24/Swords09.jpg", meaning: "" },
        { name: "10 of Swords (10 –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/d/d4/Swords10.jpg", meaning: "–ö—ñ–Ω–µ—Ü—å, –∑—Ä–∞–¥–∞, –¥–Ω–æ." },
        { name: "Page of Swords (–ü–∞–∂ –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/4/4c/Swords11.jpg", meaning: "" },
        { name: "Knight of Swords (–õ–∏—Ü–∞—Ä –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/b/b0/Swords12.jpg", meaning: "" },
        { name: "Queen of Swords (–ö–æ—Ä–æ–ª–µ–≤–∞ –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/d/d4/Swords13.jpg", meaning: "" },
        { name: "King of Swords (–ö–æ—Ä–æ–ª—å –ú–µ—á—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/3/33/Swords14.jpg", meaning: "" },
        { name: "Ace of Cups (–¢—É–∑ –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/3/36/Cups01.jpg", meaning: "–ù–æ–≤–∞ –ª—é–±–æ–≤, –µ–º–æ—Ü—ñ—ó, –ø–æ—á–∞—Ç–æ–∫." },
        { name: "2 of Cups (2 –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/f/f4/Cups02.jpg", meaning: "–ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ, –∑—É—Å—Ç—Ä—ñ—á, –∫–æ—Ö–∞–Ω–Ω—è." },
        { name: "3 of Cups (3 –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/6/6f/Cups03.jpg", meaning: "" },
        { name: "4 of Cups (4 –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/e/e2/Cups04.jpg", meaning: "" },
        { name: "5 of Cups (5 –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/d/d7/Cups05.jpg", meaning: "" },
        { name: "6 of Cups (6 –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/c/c5/Cups06.jpg", meaning: "" },
        { name: "7 of Cups (7 –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/a/af/Cups07.jpg", meaning: "" },
        { name: "8 of Cups (8 –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/7/78/Cups08.jpg", meaning: "" },
        { name: "9 of Cups (9 –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/2/24/Cups09.jpg", meaning: "" },
        { name: "10 of Cups (10 –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/8/84/Cups10.jpg", meaning: "" },
        { name: "Page of Cups (–ü–∞–∂ –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/6/62/Cups11.jpg", meaning: "" },
        { name: "Knight of Cups (–õ–∏—Ü–∞—Ä –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/f/fa/Cups12.jpg", meaning: "" },
        { name: "Queen of Cups (–ö–æ—Ä–æ–ª–µ–≤–∞ –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/6/62/Cups13.jpg", meaning: "" },
        { name: "King of Cups (–ö–æ—Ä–æ–ª—å –ö—É–±–∫—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/0/04/Cups14.jpg", meaning: "" },
        { name: "Ace of Pentacles (–¢—É–∑ –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/f/fd/Pents01.jpg", meaning: "" },
        { name: "2 of Pentacles (2 –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/9/9d/Pents02.jpg", meaning: "" },
        { name: "3 of Pentacles (3 –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/4/42/Pents03.jpg", meaning: "" },
        { name: "4 of Pentacles (4 –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/3/35/Pents04.jpg", meaning: "" },
        { name: "5 of Pentacles (5 –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/j/jd/Pents05.jpg", meaning: "" },
        { name: "6 of Pentacles (6 –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/c/c6/Pents06.jpg", meaning: "" },
        { name: "7 of Pentacles (7 –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/6/6a/Pents07.jpg", meaning: "" },
        { name: "8 of Pentacles (8 –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/4/49/Pents08.jpg", meaning: "" },
        { name: "9 of Pentacles (9 –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/f/f0/Pents09.jpg", meaning: "" },
        { name: "10 of Pentacles (10 –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/4/42/Pents10.jpg", meaning: "" },
        { name: "Page of Pentacles (–ü–∞–∂ –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/0/0a/Pents11.jpg", meaning: "" },
        { name: "Knight of Pentacles (–õ–∏—Ü–∞—Ä –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/e/ec/Pents12.jpg", meaning: "" },
        { name: "Queen of Pentacles (–ö–æ—Ä–æ–ª–µ–≤–∞ –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/8/88/Pents13.jpg", meaning: "" },
        { name: "King of Pentacles (–ö–æ—Ä–æ–ª—å –ü–µ–Ω—Ç–∞–∫–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/c/cf/Pents14.jpg", meaning: "" },
        { name: "Ace of Wands (–¢—É–∑ –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/1/11/Wands01.jpg", meaning: "" },
        { name: "2 of Wands (2 –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/0/0f/Wands02.jpg", meaning: "" },
        { name: "3 of Wands (3 –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/f/ff/Wands03.jpg", meaning: "" },
        { name: "4 of Wands (4 –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/a/a4/Wands04.jpg", meaning: "" },
        { name: "5 of Wands (5 –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/f/f0/Wands05.jpg", meaning: "" },
        { name: "6 of Wands (6 –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/c/c0/Wands06.jpg", meaning: "" },
        { name: "7 of Wands (7 –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/6/6d/Wands07.jpg", meaning: "" },
        { name: "8 of Wands (8 –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/0/05/Wands08.jpg", meaning: "" },
        { name: "9 of Wands (9 –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/0/0e/Wands09.jpg", meaning: "" },
        { name: "10 of Wands (10 –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/6/6b/Wands10.jpg", meaning: "" },
        { name: "Page of Wands (–ü–∞–∂ –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/a/ad/Wands11.jpg", meaning: "" },
        { name: "Knight of Wands (–õ–∏—Ü–∞—Ä –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/1/16/Wands12.jpg", meaning: "" },
        { name: "Queen of Wands (–ö–æ—Ä–æ–ª–µ–≤–∞ –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/0/0d/Wands13.jpg", meaning: "" },
        { name: "King of Wands (–ö–æ—Ä–æ–ª—å –ñ–µ–∑–ª—ñ–≤)", img: "https://upload.wikimedia.org/wikipedia/commons/9/93/Wands14.jpg", meaning: "" }
    ];

    const SPREAD_TYPES = {
        "1": { name: "–ë–ª—ñ—Ü", positions: ["–í—ñ–¥–ø–æ–≤—ñ–¥—å"] },
        "3": { name: "–¢—Ä–∏ –ö–∞—Ä—Ç–∏", positions: ["–ú–∏–Ω—É–ª–µ", "–¢–µ–ø–µ—Ä—ñ—à–Ω—î", "–ú–∞–π–±—É—Ç–Ω—î"] },
        "3_alt": { name: "–†–æ–∑—É–º/–°–µ—Ä—Ü–µ/–î—ñ—ó", positions: ["–î—É–º–∫–∏", "–ü–æ—á—É—Ç—Ç—è", "–î—ñ—ó"] },
        "5": { name: "–®–ª—è—Ö", positions: ["–ó–∞—Ä–∞–∑", "–ü–µ—Ä–µ—à–∫–æ–¥–∞", "–ü—Ä–∏—Ö–æ–≤–∞–Ω–µ", "–ü–æ—Ä–∞–¥–∞", "–†–µ–∑—É–ª—å—Ç–∞—Ç"] },
        "10": { 
            name: "–ö–µ–ª—å—Ç—Å—å–∫–∏–π –•—Ä–µ—Å—Ç", 
            positions: [
                "1. –°–∏—Ç—É–∞—Ü—ñ—è –∑–∞—Ä–∞–∑", 
                "2. –©–æ –ø–µ—Ä–µ—Ç–∏–Ω–∞—î (–ü—Ä–æ–±–ª–µ–º–∞)", 
                "3. –ü—ñ–¥—Å–≤—ñ–¥–æ–º–µ (–ö–æ—Ä—ñ–Ω—å)", 
                "4. –ú–∏–Ω—É–ª–µ", 
                "5. –°–≤—ñ–¥–æ–º–µ (–ú–µ—Ç–∞)", 
                "6. –ú–∞–π–±—É—Ç–Ω—î", 
                "7. –¢–∏ —Å–∞–º (–°—Ç–∞–≤–ª–µ–Ω–Ω—è)", 
                "8. –û—Ç–æ—á–µ–Ω–Ω—è", 
                "9. –ù–∞–¥—ñ—ó / –°—Ç—Ä–∞—Ö–∏", 
                "10. –ü—ñ–¥—Å—É–º–æ–∫"
            ] 
        },
        "free": { name: "–í—ñ–ª—å–Ω–∏–π –†–æ–∑–∫–ª–∞–¥", positions: [] }
    };

    let currentDeck = [];
    let drawnCards = [];
    let currentPositions = [];
    let isReadingActive = false;

    function resetAll() {
        document.getElementById('spreadArea').innerHTML = '';
        document.getElementById('outputZone').style.display = 'none';
        document.getElementById('resultText').value = '';
        document.getElementById('deckInst').style.opacity = '0';
        document.getElementById('deckContainer').classList.add('locked');
        document.getElementById('deckContainer').classList.remove('shuffling');
        document.querySelector('.finish-btn').style.display = 'none';
        isReadingActive = false;
        drawnCards = [];
        document.getElementById('countDisplay').innerText = '0';
        document.getElementById('totalDisplay').innerText = '0';
    }

    function startShuffle() {
        resetAll();
        
        const question = document.getElementById('userQuestion').value;
        if (!question.trim()) { alert("–ü–∏—Ç–∞–Ω–Ω—è —Å–ø–æ—á–∞—Ç–∫—É!"); return; }

        const selector = document.getElementById('spreadSelector');
        const spreadConfig = SPREAD_TYPES[selector.value];
        currentPositions = spreadConfig.positions;

        const cycles = parseInt(document.getElementById('shuffleCycles').value) || 3;

        const deck = document.getElementById('deckContainer');
        const c1 = document.querySelector('.c1');
        const c2 = document.querySelector('.c2');
        const c3 = document.querySelector('.c3');

        c1.style.animationIterationCount = cycles;
        c2.style.animationIterationCount = cycles;
        c3.style.animationIterationCount = cycles;

        deck.classList.add('shuffling');

        setTimeout(() => {
            deck.classList.remove('shuffling');
            deck.classList.remove('locked');
            
            currentDeck = [...tarotDeck].sort(() => Math.random() - 0.5);
            isReadingActive = true;

            document.getElementById('deckInst').style.opacity = '1';
            updateCounter();

            if (selector.value === 'free') {
                document.querySelector('.finish-btn').style.display = 'block';
                document.getElementById('totalDisplay').innerText = '‚àû';
            }

        }, cycles * 500);
    }

    function drawCard() {
        if (!isReadingActive) return;

        if (currentPositions.length > 0 && drawnCards.length >= currentPositions.length) return;

        const cardData = currentDeck.pop();
        const inverted = Math.random() < 0.5;
        const positionName = currentPositions.length > 0 ? currentPositions[drawnCards.length] : `–ö–∞—Ä—Ç–∞ ${drawnCards.length + 1}`;
        
        const displayName = inverted ? `${cardData.name} (–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞)` : cardData.name;
        const displayMeaning = inverted ? (cardData.meaning ? `${cardData.meaning} (–≤ –ø–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–æ–º—É –ø–æ–ª–æ–∂–µ–Ω–Ω—ñ - –∑–Ω–∞—á–µ–Ω–Ω—è –º–æ–∂–µ –±—É—Ç–∏ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–∏–º –∞–±–æ –æ—Å–ª–∞–±–ª–µ–Ω–∏–º)` : '(–ü–µ—Ä–µ–≤–µ—Ä–Ω—É—Ç–∞)') : cardData.meaning;

        drawnCards.push({ ...cardData, position: positionName, inverted, displayName, displayMeaning });

        const cardSlot = document.createElement('div');
        cardSlot.className = 'card-slot';
        cardSlot.innerHTML = `
            <div class="position-label">${positionName}</div>
            <div class="card-inner" onclick="flipCard(this)">
                <div class="card-front"></div>
                <div class="card-back ${inverted ? 'inverted' : ''}" style="background-image: url('${cardData.img}')"></div>
            </div>
            <div class="card-meaning">
                <strong>${displayName}</strong>
                ${displayMeaning}
            </div>
        `;
        document.getElementById('spreadArea').appendChild(cardSlot);

        updateCounter();

        if (currentPositions.length > 0 && drawnCards.length === currentPositions.length) {
            isReadingActive = false;
            document.getElementById('deckContainer').classList.add('locked');
            document.getElementById('deckInst').innerText = "–†–æ–∑–∫–ª–∞–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –í—ñ–¥–∫—Ä–∏–≤–∞–π –∫–∞—Ä—Ç–∏!";
            generateOutput();
        }
    }

    function finishSpread() {
        if (document.getElementById('spreadSelector').value !== 'free') return;
        isReadingActive = false;
        document.getElementById('deckContainer').classList.add('locked');
        document.getElementById('deckInst').innerText = "–†–æ–∑–∫–ª–∞–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –í—ñ–¥–∫—Ä–∏–≤–∞–π –∫–∞—Ä—Ç–∏!";
        document.querySelector('.finish-btn').style.display = 'none';
        generateOutput();
    }

    function updateCounter() {
        document.getElementById('countDisplay').innerText = drawnCards.length;
        const total = currentPositions.length > 0 ? currentPositions.length : '‚àû';
        document.getElementById('totalDisplay').innerText = total;
    }

    function flipCard(element) {
        if (element.classList.contains('flipped')) return;
        element.classList.add('flipped');
        setTimeout(() => {
            element.parentElement.querySelector('.card-meaning').style.display = 'block';
        }, 300);
    }

    function generateOutput() {
        const question = document.getElementById('userQuestion').value;
        const selector = document.getElementById('spreadSelector');
        const spreadName = SPREAD_TYPES[selector.value].name;

        let text = `üîÆ –ü–∏—Ç–∞–Ω–Ω—è: ${question}\nüìã –†–æ–∑–∫–ª–∞–¥: ${spreadName}\n\n`;
        drawnCards.forEach(card => {
            text += `üîπ [${card.position}]: ${card.displayName}\n   –°—É—Ç—å: ${card.displayMeaning}\n\n`;
        });
        text += "--- –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ Mystic Tarot App v3.2 ---";
        
        const textArea = document.getElementById('resultText');
        textArea.value = text;
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –≤–∏—Å–æ—Ç–∞ –ø–æ–ª—è
        textArea.style.height = 'auto';
        textArea.style.height = (textArea.scrollHeight + 10) + 'px';

        document.getElementById('outputZone').style.display = 'block';
        
        setTimeout(() => {
            document.getElementById('outputZone').scrollIntoView({ behavior: 'smooth' });
        }, 500);
    }

    function copyResult() {
        const copyText = document.getElementById("resultText");
        copyText.select();
        document.execCommand("copy");
        
        const btn = document.querySelector('.copy-btn');
        const originalText = btn.innerText;
        btn.innerText = "–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!";
        setTimeout(() => btn.innerText = originalText, 2000);
    }
</script>

</body>
</html>